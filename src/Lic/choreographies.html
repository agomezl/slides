<section>
  <h4>Choreographies</h4>
  <hr/>
</section>

<section data-background="https://media.giphy.com/media/ckwE6EJuhyRYtKCAvI/giphy.gif">
  <div style="background-color: rgba(0, 0, 0, 0.6); color: #fff; padding: 10px;">
    <h2> What is a choreography?</h2>
  </div>
  <aside class="notes">
    <ul>
      <li>It is not dancing in a group until all the problems with your system go away</li>
      <li>But there is good analogy in the confusion </li>
      <li>When dancing in a choreography it is the combined performance what
          makes each individual dance routine work
      </li>
      <li>That is why performers practice in group, and not
        separarately in their rooms with their individual
        moves
      </li>
      <li>So, back to computer science...</li>
    </ul>
  </aside>
</section>

<section>
  <blockquote>
    Choreographies are a way of describing communicating
    systems as global programs
  </blockquote>
  <aside class="notes">
    <ul>
      <li>They where first introduced in the early 2000's as a way to describe web services</li>
      <li>But they have matured to become a more general purpose approach</li>
      <li>To create an intuition of what choreographies are, lets first consider the
          most basic way a communicating system can be described using computer programs
      </li>
    </ul>
  </aside>
</section>

<!-- Program A & B animation -->
<section data-auto-animate>
  <div class="r-hstack items-start">
    <div style="width:45%;">
      <p>A (&#x1F57A;&#x1F3FD;)</p>
      <pre data-id="a-code"><code class="hljs python" data-trim
                                  data-line-numbers="2">
        x = crunch()
        send("b",x)
      </code></pre>
    </div>
    <div style="width:10%;">
    </div>
    <div style="width:45%;">
      <p>B (&#x1F57A;)</p>
      <pre data-id="b-code"><code class="hljs python"
                                  data-trim data-line-numbers="1">
        x = receive("a")
        y = crunch(x)
      </code></pre>
    </div>
  </div>
  <aside class="notes">
    <ul>
      <li>So, here we have A and B</li>
      <li>you might think of them as two performers reading their moves alone in a room but
          they are really just two computer programs</li>
      <li>Here, A sends a message to B, and B receives a message from A.</li>
      <li>Some local number crunching happens in both sides</li>
    </ul>
  </aside>
</section>

<section data-auto-animate>
  <div class="r-hstack items-start">
    <div style="width:45%;">
      <p>A</p>
      <pre data-id="a-code"><code class="hljs python" data-trim
                                  data-line-numbers="2">
        x = crunch()
        send("b",x)
      </code></pre>
    </div>
    <div style="width:10%;">
    </div>
    <div style="width:45%;">
      <p>B</p>
      <pre data-id="b-code"><code class="hljs python" data-trim
                                  data-line-numbers="1,3">
        x = receive("a")
        y = crunch(x)
        send("a",y)
      </code></pre>
    </div>
  </div>
  <aside class="notes">
  <ul>
    <li>Now, if we want to extend our interaction so that B sends to A back the values of y,
        we can not only change B
    </li>
  </ul>
  </aside>
</section>

<section data-auto-animate>
  <div class="r-hstack items-start">
    <div style="width:45%;">
      <p>A</p>
      <pre data-id="a-code"><code class="hljs python"
                                  data-trim data-line-numbers="2,3">
        x = crunch()
        send("b",x)
        y = receive("b")
      </code></pre>
    </div>
    <div style="width:10%;">
    </div>
    <div style="width:45%;">
      <p>B</p>
      <pre data-id="b-code"><code class="hljs python"
                                  data-trim data-line-numbers="1,3">
        x = receive("a")
        y = crunch(x)
        send("a",y)
      </code></pre>
    </div>
  </div>
  <aside class="notes">
    <ul>
      <li>We must also update A</li>
    </ul>
  </aside>
</section>

<section data-auto-animate>
  <div class="r-hstack items-start">
    <div style="width:45%;">
      <p>A</p>
      <pre data-id="a-code"><code class="hljs python"
                                  data-trim data-line-numbers="4-8">
        x = crunch()
        send("b",x)
        y = receive("b")
        if y > 100:
          z = crunch(y)
          send("b",z)
        else:
          exit 1
      </code></pre>
    </div>
    <div style="width:10%;">
    </div>
    <div style="width:45%;">
      <p>B</p>
      <pre data-id="b-code"><code class="hljs python"
                                  data-trim data-line-numbers="1,3">
        x = receive("a")
        y = crunch(x)
        send("a",y)
      </code></pre>
    </div>
  </div>
  <aside class="notes">
    <ul>
      <li>Similarly, if we want to send a message based on a desition A makes</li>
      <li>And here note that A is branching over the values y that it has just received from B</li>
    </ul>
  </aside>
</section>

<section data-auto-animate>
  <div class="r-hstack items-start">
    <div style="width:45%;">
      <p>A</p>
      <pre data-id="a-code"><code class="hljs python"
                                  data-trim data-line-numbers="4-8">
        x = crunch()
        send("b",x)
        y = receive("b")
        if y > 100:
          z = crunch(y)
          send("b",z)
        else:
          exit 1
      </code></pre>
    </div>
    <div style="width:10%;">
    </div>
    <div style="width:45%;">
      <p>B</p>
      <pre data-id="b-code"><code class="hljs python"
                                  data-trim data-line-numbers="4-8">
        x = receive("a")
        y = crunch(x)
        send("a",y)
        if y > 100:
          z = receive("a")
          ...
        else:
          exit 1
      </code></pre>
    </div>
  </div>
  <aside class="notes">
    <ul>
      <li>Again, B needs to be updated</li>
      <li>However, here we had to be a bit creative on how B decides whether to continue or not</li>
      <li>And it just so happens that the value of y is the same in A and B, so we can just branch on the same values</li>
      <li>But what if this was not the case?</li>
    </ul>
  </aside>
</section>

<section data-auto-animate>
  <div class="r-hstack items-start">
    <div style="width:45%;">
      <p>A</p>
      <pre data-id="a-code"><code class="hljs python"
                                  data-trim data-line-numbers="4-8">
        x = crunch()
        send("b",x)
        y = receive("b")
        z = crunch(y)
        if z > 100:
          send("b",z)
        else:
          exit 1
      </code></pre>
    </div>
    <div style="width:10%;">
    </div>
    <div style="width:45%;">
      <p data-id="b-title">B</p>
      <pre data-id="b-code"><code class="hljs python"
                                  data-trim data-line-numbers>
        x = receive("a")
        y = crunch(x)
        send("a",y)
      </code></pre>
      <h2 class="fragment fade-up">?</h2>
    </div>
  </div>
  <aside class="notes">
    <ul>
      <li>What if A was branching on z instead?</li>
      <li>do we send another message?</li>
      <li>do we compute z in B as well?</li>
      <li>Is not a hard problem to solve, but it might get annoying</li>
      <li>and the bigger the system becomes the more difficut it
          becomes to keep track of all this</li>
    </ul>
  </aside>

</section>

<!-- Choreography animation -->
<section data-auto-animate>
  <div class="r-hstack items-center">
    <div style="width:45%;">
      <pre><code class="hljs js" data-trim data-line-numbers>
        let x@a = crunch()
        a[x] -> b.x
        let y@b = crunch(x)
      </code></pre>
    </div>
    <div data-id="vl" class="r-hstack" style="width:10%;align-self:stretch;">
      <div class="vl"></div>
    </div>
    <div class="fragment fade-left" style="width:45%;">
      <p>A</p>
      <pre data-id="a-code" style="margin-top:0px;"><code class="hljs python"
                                                          data-trim data-line-numbers>
        x = crunch()
        send("b",x)
      </code></pre>
      <p>B</p>
      <pre data-id="b-code" style="margin-top:0px;"><code class="hljs python"
                                                          data-trim data-line-numbers>
        x = receive("a")
        y = crunch(x)
      </code></pre>
    </div>
  </div>
<aside class="notes">
  <ul>
    <li>A choreography is a way to have all interactions in one place</li>
    <li>The effect is the same, changing things becomes much more easy</li>
  </ul>
</aside>
</section>

<section data-auto-animate>
  <div class="r-hstack items-center">
    <div style="width:45%;">
      <pre data-id="chor"><code class="hljs js" data-trim
                                data-line-numbers>
        let x@a = crunch()
        a[x] -> b.x
        let y@b = crunch(x)
      </code></pre>
    </div>
    <div data-id="vl" class="r-hstack" style="width:10%;align-self:stretch;">
      <div class="vl"></div>
    </div>
    <div style="width:45%;">
      <p>A</p>
      <pre data-id="a-code" style="margin-top:0px;"><code class="hljs python"
                                                          data-trim data-line-numbers="3">
        x = crunch()
        send("b",x)
        y = receive("b")
      </code></pre>
      <p>B</p>
      <pre data-id="b-code" style="margin-top:0px;"><code class="hljs python"
                                                          data-trim data-line-numbers="3">
        x = receive("a")
        y = crunch(x)
        send("a",y)
      </code></pre>
    </div>
  </div>
  <aside class="notes">
  <ul>
    <li>For example, adding a new communication between A and B</li>
    <li>Become a simple task</li>
  </ul>
  </aside>
</section>

<section data-auto-animate>
  <div class="r-hstack items-center">
    <div style="width:45%;">
      <pre data-id="chor"><code class="hljs js" data-trim data-line-numbers="4">
        let x@a = crunch()
        a[x] -> b.x
        let y@b = crunch(x)
        b[y] -> a.y
      </code></pre>
    </div>
    <div data-id="vl" class="r-hstack" style="width:10%;align-self:stretch;">
      <div class="vl"></div>
    </div>
    <div style="width:45%;">
      <p>A</p>
      <pre data-id="a-code" style="margin-top:0px;"><code class="hljs python"
                                                          data-trim data-line-numbers="3">
        x = crunch()
        send("b",x)
        y = receive("b")
      </code></pre>
      <p>B</p>
      <pre data-id="b-code" style="margin-top:0px;"><code class="hljs python"
                                                          data-trim data-line-numbers="3">
        x = receive("a")
        y = crunch(x)
        send("a",y)
      </code></pre>
    </div>
  </div>
  <aside class="notes">
    <ul>
      <li>Just adding a communication operation, which in a
      choreography nicely combines the send and receive operations
      of the individual processes
      </li>
    </ul>
  </aside>
</section>

<section data-auto-animate>
  <div class="r-hstack items-center">
    <div style="width:45%;">
      <pre data-id="chor"><code class="hljs js" data-trim data-line-numbers>
        let x@a = crunch()
        a[x] -> b.x
        let y@b = crunch(x)
        b[y] -> a.y
      </code></pre>
    </div>
    <div data-id="vl" class="r-hstack" style="width:10%;align-self:stretch;">
      <div class="vl"></div>
    </div>
    <div style="width:45%;">
      <p>A</p>
      <pre data-id="a-code" style="margin-top:0px;"><code class="hljs python"
                                                          data-trim data-line-numbers=>
        ...
        if y > 100:
          z = crunch(y)
          send("b",z)
        else:
          exit 1
      </code></pre>
      <p>B</p>
      <pre data-id="b-code" style="margin-top:0px;"><code class="hljs python"
                                                          data-trim data-line-numbers=>
        ...
        if y > 100:
          z = receive("a")
          ...
        else:
          exit 1
      </code></pre>
    </div>
  </div>
  <aside class="notes">
    <ul>
      <li>And when thing become a little more hairy</li>
      <li>Choreography provide an strutured approach</li>
    </ul>
  </aside>
</section>

<section data-auto-animate>
  <div class="r-hstack items-center">
    <div style="width:45%;">
      <pre data-id="chor"><code class="hljs js" data-trim data-line-numbers="|2,3|4,9|5,6">
        //...
        let v@a = y > 100
        if v@a {
          a&lt;T&gt; -> b
          let z@a = crunch(y)
          a.[z] -> b.z
          //...
        } else {
          a&lt;F&gt; -> b
          //DONE
        }
      </code></pre>
    </div>
    <div data-id="vl" class="r-hstack" style="width:10%;align-self:stretch;">
      <div class="vl"></div>
    </div>
    <div style="width:45%;">
      <p>A</p>
      <pre data-id="a-code" style="margin-top:0px;"><code class="hljs python"
                                                          data-trim data-line-numbers=>
        ...
        if y > 100:
          z = crunch(y)
          send("b",z)
        else:
          exit 1
      </code></pre>
      <p>B</p>
      <pre data-id="b-code" style="margin-top:0px;"><code class="hljs python"
                                                          data-trim data-line-numbers=>
        ...
        if y > 100:
          z = receive("a")
          ...
        else:
          exit 1
      </code></pre>
    </div>
  </div>
  <aside class="notes">
    <ul>
      <li>By clearely marking where the branching decition is being made</li>
      <li>And enforcing that all processes are on the same page about it</li>
    </ul>
  </aside>
</section>

<section data-auto-animate>
  <div class="r-hstack items-center">
    <div style="width:45%;">
      <p>(&#x1F57A;&#x1F57A;&#x1F3FD;)</p>
      <pre data-id="chor"><code class="hljs js" data-trim data-line-numbers>
        //...
        let v@a = y > 100
        if v@a {
          a&lt;T&gt; -> b
          let z@a = crunch(y)
          a.[z] -> b.z
          //...
        } else {
          a&lt;F&gt; -> b
          //DONE
        }
      </code></pre>
    </div>
  </div>
  </div>
  <aside class="notes">
    <ul>
      <li>So you can think of a choreographyas all the performers
          sitting in a room doing their rutines together and knowing
          what they have to do</li>
    </ul>
  </aside>
</section>

<!-- Syntax -->

<section>
  <p>Syntax</p>
  <aside class="notes">
    <ul>
      <li>So, lets go into more detail of how the this language looks</li>
      <li>Specically our implentation of it, there are ofcourse a
        number of variations around</li>
    </ul>
  </aside>
</section>

<section>
  <table class="grammar">
    <tbody>
      <tr><td><code>G</code></td><td><code>::=</code></td>
          <td><code>A[x] -> B.y; G</code></td><td>(com)</td></tr>
      <tr><td></td><td style="text-align:center"><code>|</code></td>
          <td><code>A&lt;b&gt; -> B; G</code></td><td>(sel)</td></tr>
      <tr><td></td><td style="text-align:center"><code>|</code></td>
          <td><code><span keyword>Let</span> x@a = foo(..); G</code></td><td>(let)</td></tr>
      <tr><td></td><td style="text-align:center"><code>|</code></td>
          <td><code><span keyword>If</span> x@a
                    <span keyword>Then</span> G
                    <span keyword>Else</span> G</code></td><td>(if)</td></tr>
      <tr><td></td><td style="text-align:center"><code>|</code></td>
          <td><code><span keyword>End</span></code></td><td>(end)</td></tr>
    </tbody>
  </table>
  <aside class="notes">
    <ul>
      <li>Noting too out of the ordinary here</li>
      <li>However, note that aside from the communication primitives
          com and sel the language is remarkably simple</li>
      <li>Perhaps too simple? how do I do anything other than talking to my neighbor here?</li>
      <li>every evaluation happens inside a let, hence we use the
          underlying implentation language to generate values</li>
    </ul>
  </aside>
</section>

<!-- Semantics -->

<section>
  <p>Semantics</p>
</section>

<section>
  <h3>$(s,c) \xrightarrow{(\tau,l)} (s',c')$</h3>
  <div class="fragment fade-up" style="margin-top:1em">
    <hr/>
    <p style="text-align:left">Where:</p>
    <ul>
      <li>$c$ and $c'$ are choreographies</li>
      <li>$s$ and $s'$ are mappings from pairs of process and
        variables to values</li>
    </ul>
  </div>
  <aside class="notes">
    <ul>
      <li>Its a small step semantics with tagged transition and a
          list of asyncronous operations</li>
    </ul>
  </aside>
</section>

<!-- Communication rule -->

<!-- <section data-auto-animate>
     <p style="text-align:left">Communication:</p>
     <table class="rule">
     <tbody>
     <tr data-id="i0"><td><code>s(p,x)=d</code></td><td><code>p!=q</code></td></tr>
     <tr><td colspan="2"><code>(s,<span data-id="i1">p[x]->q.y</span>;c) ==> (<span data-id="i2">s[(q,y)|->d]</span>,c)</code></td></tr>
     </tbody>
     </table>
     </section> -->

<!-- <section data-auto-animate>
     <p style="text-align:left">Communication:</p>
     <table class="rule">
     <tbody>
     <tr data-id="i0"><td><code>s(p,x)=d</code></td><td><code>p!=q</code></td></tr>
     <tr><td colspan="2"><code>(s,<span hl data-id="i1">p[x]->q.y</span>;c) ==> (<span hl data-id="i2">s[(q,y)|->d]</span>,c)</code></td></tr>
     </tbody>
     </table>
     </section> -->

<section>
  <div class="r-vstack items-center">
    <p>Communication</p>
    <table class="rule">
      <tbody>
        <tr><td>$s(p,x)=d$</td><td>$p \neq q$</td></tr>
        <tr><td colspan="2">
          $(s,p[x] \to q.y ; c)
          \xrightarrow{(\text{com p x q y},[])}
          (s[(q,y) \to d], c)$
        </td></tr>
      </tbody>
    </table>
  </div>
</section>

<!-- Selection rule -->

<!-- <section>
     <p style="text-align:left">Selection:</p>
     <table class="rule">
     <tbody>
     <tr><td><code>p!=q</code></td></tr>
     <tr><td><code>(s,p&lt;b&gt;->q.y</span>;c) -> (s,c)</code></td></tr>
     </tbody>
     </table>
     </section> -->

<section>
  <div class="r-vstack items-center">
    <p>Selection</p>
    <table class="rule">
      <tbody>
        <tr><td>$p \neq q$</td></tr>
        <tr><td>$(s,p\langle b\rangle \to q ; c) \xrightarrow{(\text{sel p b q},[])}  (s, c)$</td></tr>
      </tbody>
    </table>
  </div>
</section>

<!-- Branching rule -->

<section>
  <div class="r-vstack items-center">
    <p>Branching</p>
    <table class="rule">
      <tbody>
        <tr><td>$s(p,v)=\top$</td></tr>
        <tr><td>
          $(s, \text{If}\,v@p\,\text{Then}\,c_1\,\text{Else}\,c_2)
          \xrightarrow{(\text{LTau p v},[])}
          (s, c_1)$
        </td></tr>
      </tbody>
    </table>
  </div>
</section>

<!-- Features -->
<section>
  <p>Features<span class="fragment fade-left">?</span></p>
</section>

<!-- Concurrency -->

<section data-auto-animate>
  <div class="r-vstack items-center">
    <p>Concurrency</p>
    <div style="width:30%;">
      <pre data-id="chor"><code class="hljs js" data-trim data-line-numbers>
        ...
        a[x] -> b.y
        p[z] -> q.w
      </code></pre>
    </div>
  </div>
  <aside class="notes">
    <ul>
      <li>Deals with unrelated operations</li>
    </ul>
  </aside>
</section>

<section data-auto-animate>
  <div class="r-vstack items-center">
    <p>Concurrency</p>
    <div style="width:30%;">
      <pre data-id="chor"><code class="hljs js" data-trim data-line-numbers>
        ...
        a[x] -> b.y
      </code></pre>
    </div>
  </div>
</section>

<section data-auto-animate>
  <div class="r-vstack items-center">
    <p>Concurrency</p>
    <table class="rule fragment fade-up">
      <tbody>
        <tr><td>$(s,c) \xrightarrow{(\alpha,l)} (s',c')$</td>
            <td>$p \notin \text{pn}(\alpha)$</td>
            <td>$q \notin \text{pn}(\alpha)$</td></tr>
        <tr><td colspan="3">$(s,p[x] \to q.y ; c)) \xrightarrow{(\alpha,l)} (s',p[x] \to q.y ; c')$</td></tr>
      </tbody>
    </table>
  </div>
</section>

<!-- Asyncrony -->

<section data-auto-animate>
  <div class="r-vstack items-center">
    <p>Asynchrony</p>
    <div class="fragment fade-up" style="width:30%;">
      <pre data-id="chor"><code class="hljs js" data-trim data-line-numbers>
        ...
        a[x] -> b.y
        q[z] -> a.w
      </code></pre>
    </div>
  </div>
  <aside class="notes">
    <ul>
      <li>Deals with operations a sender might perfom
          before a communication is completed</li>

    </ul>
  </aside>

</section>

<section data-auto-animate>
  <div class="r-vstack items-center">
    <p>Asynchrony</p>
    <div style="width:30%;">
      <pre data-id="chor"><code class="hljs js" data-trim data-line-numbers>
        ...
        a[x] -> b.y
      </code></pre>
    </div>
  </div>
  <aside class="notes">
    <ul>
      <li>this is quite tricky</li>
    </ul>
  </aside>
</section>

<section data-auto-animate>
  <div class="r-vstack items-center">
    <p>Asynchrony</p>
    <table class="rule fragment fade-up">
      <tbody>
        <tr>
          <td>$(s,c) \xrightarrow{(\alpha,l)} (s',c')$</td>
          <td>
            <div class="r-vstack items-start">
              <div>$p \in \text{pn}(\alpha)$</div>
              <div>$q \notin \text{pn}(\alpha)$</div>
              <div>$\text{written}(\alpha) \neq (p,x)$</div>
            </div>
          </td>
        </tr>
        <tr><td colspan="2">
          $(s,p[x] \to q.y ; c)
          \xrightarrow{(\alpha,\text{com p x q y}::l)}
          (s',p[x] \to q.y ; c')$
        </td></tr>
      </tbody>
    </table>
  </div>
  <aside class="notes">
    <ul>
      <li>Where we are not allowed to "jump" over operations
          involving processes as receivers because a receive
          operation is blocking
      </li>
    </ul>
  </aside>
</section>

<!-- End point projection -->

<section>
  <p>Projection</p>
  <aside class="notes">
    <ul>
      <li>Previous features where to be expected, since we are
          modeling a concurrent systems at the end of the day</li>

      <li>This is perhaps the more useful feature</li>
      <li>In a way similar to how choreographies could represent
          individual processes</li>
      <li>One could imagine directly generating code for individual
          processes using a choreographies as the source
      </li>
    </ul>
</section>

<section data-auto-animate>
  <div class="r-vstack items-center">
    <div style="width:45%">
      <pre data-id="chor"><code class="hljs js" data-trim data-line-numbers="|1">
        let x@a = crunch()
        let y@b = crunch()
        a[x] -> b.x
        b[y] -> a.y
      </code></pre>
      </div>
  </div>
</section>

<section data-auto-animate>
  <div class="r-vstack items-center">
    <div style="width:45%">
      <pre data-id="chor"><code class="hljs js" data-trim data-line-numbers="1|2">
        let x@a = crunch()
        let y@b = crunch()
        a[x] -> b.x
        b[y] -> a.y
      </code></pre>
    </div>
    <hr data-id="line" style="align-self:stretch"/>
    <div class="r-hstack items-center" style="align-self:stretch">
      <div style="width:45%;">
        <p>A</p>
        <pre data-id="a-code"><code class="hljs python" data-trim
                                    data-line-numbers=>
        x = crunch()
        </code></pre>
      </div>
    </div>
  </div>
</section>

<section data-auto-animate>
  <div class="r-vstack items-center">
    <div style="width:45%">
      <pre data-id="chor"><code class="hljs js" data-trim data-line-numbers="2|3">
        let x@a = crunch()
        let y@b = crunch()
        a[x] -> b.x
        b[y] -> a.y
      </code></pre>
    </div>
    <hr data-id="line" style="align-self:stretch"/>
    <div class="r-hstack items-center" style="align-self:stretch">
      <div style="width:45%;">
        <p>A</p>
        <pre data-id="a-code"><code class="hljs python" data-trim
                                    data-line-numbers=>
        x = crunch()
        </code></pre>
      </div>
      <div style="width:10%;">
      </div>
      <div style="width:45%;">
        <p>B</p>
        <pre data-id="b-code"><code class="hljs python" data-trim
                                    data-line-numbers=>
        y = crunch()
        </code></pre>
      </div>
    </div>
  </div>
</section>

<section data-auto-animate>
  <div class="r-vstack items-center">
    <div style="width:45%">
      <pre data-id="chor"><code class="hljs js" data-trim data-line-numbers="3|4">
        let x@a = crunch()
        let y@b = crunch()
        a[x] -> b.x
        b[y] -> a.y
      </code></pre>
    </div>
    <hr data-id="line" style="align-self:stretch"/>
    <div class="r-hstack items-center" style="align-self:stretch">
      <div style="width:45%;">
        <p>A</p>
        <pre data-id="a-code"><code class="hljs python" data-trim
                                    data-line-numbers=>
        x = crunch()
        send("b",x)
        </code></pre>
      </div>
      <div style="width:10%;">
      </div>
      <div style="width:45%;">
        <p>B</p>
        <pre data-id="b-code"><code class="hljs python" data-trim
                                    data-line-numbers=>
        y = crunch()
        x = receive("a")
        </code></pre>
      </div>
    </div>
  </div>
</section>

<section data-auto-animate>
  <div class="r-vstack items-center">
    <div style="width:45%">
      <pre data-id="chor"><code class="hljs js" data-trim data-line-numbers="4">
        let x@a = crunch()
        let y@b = crunch()
        a[x] -> b.x
        b[y] -> a.y
      </code></pre>
    </div>
    <hr data-id="line" style="align-self:stretch"/>
    <div class="r-hstack items-center" style="align-self:stretch">
      <div style="width:45%;">
        <p>A</p>
        <pre data-id="a-code"><code class="hljs python" data-trim
                                    data-line-numbers=>
        x = crunch()
        send("b",x)
        y = receive("b")
        </code></pre>
      </div>
      <div style="width:10%;">
      </div>
      <div style="width:45%;">
        <p>B</p>
        <pre data-id="b-code"><code class="hljs python" data-trim
                                    data-line-numbers=>
        y = crunch()
        x = receive("a")
        send("a",y)
        </code></pre>
      </div>
    </div>
  </div>
</section>

<!-- Confluence -->

<section>
  <p>Confluence</p>
</section>

<section>
  <div>
    <img style="max-width: 95%;" src="Lic/confluence.png"/>
  </div>
  <aside class="notes">
    <ul>
      <li>This is a must, since it relives you from worring abouth paths that might lead you into trouble</li>
    </ul>
  </aside>
</section>

<!-- Deadlock-freedom -->

<section>
  <div class="r-vstack items-center">
    <p>Deadlock-freedom</p>
    <table class="rule fragment fade-up">
      <tbody>
          <tr><td>
            $\exists{s,s'.}{(s,c) \xrightarrow{\;\ast\;} (s',end)}$
          </td></tr>
      </tbody>
    </table>
  </div>
  <aside class="notes">
    <ul>
      <li>The cherry on top! and the reason this
          approach solves communication inconsistencies</li>
      <li>There can not be a missmatch since there are
          no individual sends and receives
      </li>
    </ul>
  </aside>
</section>

<!-- The road to CakeML -->

<section data-auto-animate>
  <div class="r-hstack items-center">
    <div style="width:30%;">
      <pre data-id="chor"><code class="hljs js" data-trim>
        a[x] -> b.x
        b[y] -> a.y
      </code></pre>
    </div>
    <div style="width:10%;">
      <h2><i data-id="a1" class="fas fa-arrow-right"></i></h2>
    </div>
    <div class="r-vstack items-start" style="width:20%;">
      <img data-id="cake" style="min-width: 65%; margin-left:20px;" src="Lic/CakeML.svg"/>
    </div>
  </div>
  <aside class="notes">
    <ul>
      <li>So, we have good idea, and a nice verified compiler laying around</li>
      <li>It only makes sence to try and use them together!</li>
      <li>With proofs and all!</li>
    </ul>
  </aside>
</section>

<section data-auto-animate>
  <div class="r-hstack items-center">
    <div style="width:30%;">
      <pre data-id="chor"><code class="hljs js" data-trim>
        a[x] -> b.x
        b[y] -> a.y
      </code></pre>
    </div>
    <div style="width:10%;">
      <h2><i data-id="a2" class="fas fa-arrow-right"></i></h2>
    </div>
    <div style="width:12%;">
      <h2><i data-id="e1" class="far fa-file-alt"></i></h2>
    </div>
    <div style="width:10%;">
      <h2><i data-id="a1" class="fas fa-arrow-right"></i></h2>
    </div>
    <div class="r-vstack items-start" style="width:40%;">
      <img data-id="cake" style="min-width: 40%; margin-left:20px;" src="Lic/CakeML.svg"/>
    </div>
  </div>
  <aside class="notes">
    <ul>
      <li>The top level choreography language is perhaps too high-level to just directly translate</li>
      <li>So, in tipical CakeML fasion we use an intermediate language!</li>
    </ul>
  </aside>
</section>

<section data-auto-animate>
  <div class="r-hstack items-center">
    <div style="width:30%;">
      <pre data-id="chor"><code class="hljs js" data-trim>
        a[x] -> b.x
        b[y] -> a.y
      </code></pre>
    </div>
    <div style="width:10%;">
      <h2><i data-id="a2" class="fas fa-arrow-right"></i></h2>
    </div>
    <div style="width:12%;">
      <h2><i data-id="e2" class="far fa-file-alt"></i></h2>
    </div>
    <div style="width:10%;">
      <i data-id="d1" class="fas fa-ellipsis-h"></i>
    </div>
    <div style="width:12%;">
      <h2><i data-id="e1" class="far fa-file-alt"></i></h2>
    </div>
    <div style="width:10%;">
      <h2><i data-id="a1" class="fas fa-arrow-right"></i></h2>
    </div>
    <div class="r-vstack items-start" style="width:40%;">
      <img data-id="cake" style="min-width: 40%; margin-left:20px;" src="Lic/CakeML.svg"/>
    </div>
  </div>
  <aside class="notes">
    <ul>
      <li>Actually, we use many!!</li>
    </ul>
  </aside>
</section>

<!-- EPN -->

<section>
  <p>An endpoint language</p>
  <aside class="notes">
    <ul>
      <li>Using concurrency jargon, an enpoint is one of the component
      in the system or "network" that talks to other
      component/endpoint</li>
    </ul>
  </aside>
</section>

<!-- EPN syntax -->

<section>
  <table class="grammar">
    <tbody>
      <tr><td><code>EPN</code></td><td><code>::=</code></td>
          <td><code>&lt;p,s,q,EP&gt;</code></td><td>(Single)</td></tr>
      <tr><td></td><td style="text-align:center"><code>|</code></td>
          <td><code>&lt;p,s,q,EP&gt; || EPN</code></td><td>(Parallel)</td></tr>
    </tbody>
  </table>
  <div style="margin-top:1em">
    <hr/>
    <p style="text-align:left">Where:</p>
    <ul>
      <li>(<code>p</code>) is a process name</li>
      <li>(<code>s</code>) is a mappings from varible names to values
        representing the process state,</li>
      <li>(<code>q</code>) is a queue of unread messages</li>
      <li>(<code>EP</code>) is the endpoint code</li>
    </ul>
  </div>
</section>

<!-- EP syntax -->

<section>
  <table class="grammar">
    <tbody>
      <tr><td><code>EP</code></td><td><code>::=</code></td>
          <td><code><span keyword>Send</span> p x; EP</code></td></tr>
      <tr><td></td><td style="text-align:center"><code>|</code></td>
          <td><code><span keyword>Receive</span> p y; EP</code></td></tr>
      <tr><td></td><td style="text-align:center"><code>|</code></td>
          <td><code><span keyword>InternalChoice</span> p b; EP</code></td></tr>
      <tr><td></td><td style="text-align:center"><code>|</code></td>
          <td><code><span keyword>ExternalChoice</span> p EP EP</code></td></tr>
      <tr><td></td><td style="text-align:center"><code>|</code></td>
          <td><code><span keyword>Let</span> v f vl <span keyword>in</span> EP</code></td></tr>
      <tr><td></td><td style="text-align:center"><code>|</code></td>
          <td><code><span keyword>End</span></code></td></tr>
    </tbody>
  </table>
</section>

<!-- Semantics -->

<section data-auto-animate>
  <div class="r-hstack items-start">
    <div style="width:45%;">
      <p><code>&lt;a,sa,qa,<i style="font-size:30px" class="fas fa-arrow-down"></i>&gt;</code></p>
      <pre data-id="a-code" style="margin-top:0px;"><code class="hljs haskell"
                                                          data-trim data-line-numbers="1">
        Send b x
        ...
      </code></pre>
      <p class="fragment fade-up"><code>sa(x) = d</code></p>
    </div>
    <div data-id="vl" class="r-hstack" style="width:10%;align-self:stretch;">
      <div class="vl"></div>
    </div>
    <div  style="width:45%;">
      <p><code>&lt;b,sb,qb,<i style="font-size:30px" class="fas fa-arrow-down"></i>&gt;</code></p>
      <pre data-id="b-code" style="margin-top:0px;"><code class="hljs haskell"
                                                          data-trim data-line-numbers="1">
        Receive a x
        ...
      </code></pre>
    </div>
  </div>
</section>

<section data-auto-animate>
  <div class="r-hstack items-start">
    <div style="width:46%;">
      <p><code>&lt;a,sa,qa,<i style="font-size:30px" class="fas fa-arrow-down"></i>&gt;</code></p>
      <pre data-id="a-code" style="margin-top:0px;"><code class="hljs haskell"
                                                          data-trim data-line-numbers>
        ...
      </code></pre>
      <p><code>sa(x) = d</code></p>
    </div>
    <div data-id="vl" class="r-hstack" style="width:8%;align-self:stretch;">
      <div class="vl"></div>
    </div>
    <div  style="width:46%;">
      <p><code>&lt;b,sb,a,qb',<i style="font-size:30px" class="fas fa-arrow-down"></i>&gt;</code></p>
      <pre data-id="b-code" style="margin-top:0px;"><code class="hljs haskell"
                                                          data-trim data-line-numbers="1">
        Receive a x
        ...
      </code></pre>
      <p><code>qb' = (a,d)::qb</code></p>
    </div>
  </div>
    <aside class="notes">
    <ul>
      <li>On receive B deques the first message from A in the queue</li>
    </ul>
  </aside>
</section>

<section data-auto-animate>
  <div class="r-hstack items-start">
    <div style="width:46%;">
      <p><code>&lt;a,sa,qa,<i style="font-size:30px" class="fas fa-arrow-down"></i>&gt;</code></p>
      <pre data-id="a-code" style="margin-top:0px;"><code class="hljs haskell"
                                                          data-trim data-line-numbers>
        ...
      </code></pre>
    </div>
    <div data-id="vl" class="r-hstack" style="width:8%;align-self:stretch;">
      <div class="vl"></div>
    </div>
    <div  style="width:46%;">
      <p><code>&lt;b,sb',a,qb,<i style="font-size:30px" class="fas fa-arrow-down"></i>&gt;</code></p>
      <pre data-id="b-code" style="margin-top:0px;"><code class="hljs haskell"
                                                          data-trim data-line-numbers>
        ...
      </code></pre>
      <p><code>sb' = sb[x |-> d]</code></p>
    </div>
  </div>
</section>

<!-- Projection function -->

<section>
  <p><code>project(p,c) = (succ,EP)</code></p>
  <div class="fragment fade-up" style="margin-top:1em">
    <hr/>
    <p style="text-align:left">Where:</p>
    <ul>
      <li>(<code>p</code>) is a process name</li>
      <li>(<code>c</code>) is a choreography</li>
      <li>(<code>EP</code>) is a single endpoint</li>
      <li>(<code>succ</code>) is a boolean signaling success</li>
    </ul>
  </div>
  <aside class="notes">
    <ul>
      <li>Now on how to turn one thing into the other!</li>
    </ul>
  </aside>
</section>

<section>
  <pre data-id="a-code" style="margin-top:0px;"><code class="hljs haskell"
                                                          data-trim data-line-numbers="|4-5|6-7|8-9|10">
    Definition project_def:
    ...
    ∧ project proc (Com p1 v1 p2 v2 c) =
        if proc = p1 ∧ proc = p2
        then (F,Nil)
        else if proc = p1
             then Send p2 v1 <Γ> project proc c
             else if proc = p2
                  then Receive p1 v2 <Γ> project proc
                  else project proc c
    ...
  </code></pre>
</section>

<!-- Lemmas -->

<section>
  <div class="r-vstack items-center">
    <p>Semantic preservation</p>
    <table class="rule">
      <tbody>
        <tr><td>$(s,c)\xrightarrow{}(s',c')$</td></tr>
        <tr><td>$\exists{c'',s''.\;}(s',c')\rightarrow^{\ast}(s'',c'')\,\land\,
                [\![s,c]\!]\rightarrow^{\ast}[\![s'',c'']\!]$</td></tr>
      </tbody>
    </table>
  </div>
</section>

<section>
  <div class="r-vstack items-center">
    <p>Semantic reflection</p>
    <table class="rule">
      <tbody>
        <tr><td>$[\![s,c]\!]\xrightarrow{}epn$</td></tr>
        <tr><td>$\exists{c',s'.\;}epn\rightarrow^{\ast}[\![s',c']\!]\,\land\,
                 (s,c)\rightarrow^{\ast}(s',c')$</td></tr>
      </tbody>
    </table>
  </div>
</section>

<!-- IL -->
<section data-auto-animate>
  <div class="r-hstack items-center">
    <div data-id="b1" style="padding : 10px 20px 10px 20px" class="r-vstack items-center block">
      <div><i data-id="f1" class="far fa-file-alt"></i></div>
      <p style="margin:0 0 0 0;">EPN</p>
    </div>
    <div style="width:12%;">
      <h2><i class="fas fa-arrow-right"></i></h2>
    </div>
    <div class="r-vstack items-start" style="width:20%;">
      <img data-id="cake" style="min-width: 65%;" src="Lic/CakeML.svg"/>
    </div>
  </div>
</section>

<section data-auto-animate>
  <div class="r-hstack items-center">
    <div data-id="b1" style="padding : 10px 20px 10px 20px" class="r-vstack items-center block">
      <div><i data-id="f1" class="far fa-file-alt"></i></div>
      <p style="margin:0 0 0 0;">EPN</p>
    </div>
    <div style="width:12%;">
      <h2><i class="fas fa-arrow-right"></i></h2>
    </div>
    <div style="padding : 10px 20px 10px 20px" class="r-vstack items-center block">
      <div><i  class="far fa-file-alt"></i></div>
      <p style="margin:0 0 0 0;"><del>Selection</del></p>
    </div>
    <div style="width:12%;">
      <h2><i class="fas fa-arrow-right"></i></h2>
    </div>
    <div style="padding : 10px 20px 10px 20px" class="r-vstack items-center block">
      <div><i  class="far fa-file-alt"></i></div>
      <p style="margin:0 0 0 0;">Payload</p>
    </div>
    <div style="width:12%;">
      <h2><i class="fas fa-arrow-right"></i></h2>
    </div>

    <div class="r-vstack items-start" style="width:20%;">
      <img style="min-width: 65%;" src="Lic/CakeML.svg"/>
    </div>
  </div>
</section>

<section>
  <div class="r-hstack items-start">
    <div style="width:45%;" class="r-vstack items-center">
      <pre><code class="hljs haskell" data-trim data-line-numbers>
        IntChoice b p
        ...
      </code></pre>
      <h2><i class="fas fa-arrow-down"></i></h2>
      <pre><code class="hljs haskell"
                                                          data-trim data-line-numbers>
        Let fv = T
        Send p fv
        ...
      </code></pre>
    </div>
    <div class="r-hstack" style="width:10%;align-self:stretch;">
      <div class="vl"></div>
    </div>
    <div style="width:45%;" class="r-vstack items-center">
      <pre><code class="hljs haskell" data-trim data-line-numbers>
        ExternalChoice p e1 e2
      </code></pre>
      <h2><i class="fas fa-arrow-down"></i></h2>
      <pre><code class="hljs haskell" data-trim data-line-numbers>
        Receive p fv
        If fv Then e1 Else e2
      </code></pre>
    </div>
  </div>
</section>

<section>
  <div class="r-hstack items-start">
    <div style="width:45%;" class="r-vstack items-center">
      <pre><code class="hljs haskell" data-trim data-line-numbers>
        Send p vlm
        ...
      </code></pre>
      <h2><i class="fas fa-arrow-down"></i></h2>
      <pre><code class="hljs haskell"
                                                          data-trim data-line-numbers>
        Send p v
        Send p l
        Send p m
        ...
      </code></pre>
    </div>
    <div class="r-hstack" style="width:10%;align-self:stretch;">
      <div class="vl"></div>
    </div>
    <div style="width:45%;" class="r-vstack items-center">
      <pre><code class="hljs haskell" data-trim data-line-numbers>
        Receive p vlm
        ...
      </code></pre>
      <h2><i class="fas fa-arrow-down"></i></h2>
      <pre><code class="hljs haskell" data-trim data-line-numbers>
        Receive p v
        Receive p l
        Receive p m
        ...
      </code></pre>
    </div>
  </div>
  <div class="fragment fade-up"><i>*Wildly oversimplified</i></div>
</section>

<section>
  <img style="min-width: 20%;" src="Lic/CakeML.svg"/>
</section>

<section>
  <h3>Demo</h3>
</section>
